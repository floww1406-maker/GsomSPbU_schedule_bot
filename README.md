# üìö GSOM Schedule Bot

Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç–∞ **–í—ã—Å—à–µ–π —à–∫–æ–ª—ã –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞ –°–ü–±–ì–£ (GSOM)**.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –Ω–µ–¥–µ–ª—é
- üìÜ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É
- üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–∑–∞—á—ë—Ç—ã, —ç–∫–∑–∞–º–µ–Ω—ã, –ø–æ–∫–∞–∑ —Ä–∞–±–æ—Ç)
- üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
- üéì –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –ø–æ –≥–æ–¥—É –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gsom_schedule_bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py     # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ states.py        # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ texts.py         # –¢–µ–∫—Å—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ db.py            # –†–∞–±–æ—Ç–∞ —Å SQLite
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ spbu_api.py      # –ö–ª–∏–µ–Ω—Ç API —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –°–ü–±–ì–£
‚îÇ   ‚îú‚îÄ‚îÄ schedule_service.py    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ scheduler_service.py   # –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ datetime_utils.py # –£—Ç–∏–ª–∏—Ç—ã –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏
‚îú‚îÄ‚îÄ data/                # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ë–î (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))
- –í–∞—à Telegram ID (–¥–ª—è –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–π)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ / —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ git
git clone <repository_url>
cd gsom_schedule_bot

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
python -m venv venv

# Linux/macOS
source venv/bin/activate

# Windows
venv\Scripts\activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env
nano .env  # –∏–ª–∏ –ª—é–±–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª `.env`:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
BOT_TOKEN=1234567890:AABBccDDeeFFggHHiiJJkkLLmmNNooP
ADMIN_ID=123456789

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
DATABASE_PATH=data/bot.db
CHECK_INTERVAL_MINUTES=10
SPBU_API_URL=https://timetable.spbu.ru/api/v1
GSOM_ALIAS=GSOM
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å BOT_TOKEN:**
1. –ù–∞–ø–∏—à–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

**–ö–∞–∫ —É–∑–Ω–∞—Ç—å ADMIN_ID:**
1. –ù–∞–ø–∏—à–∏—Ç–µ [@userinfobot](https://t.me/userinfobot) –≤ Telegram
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID

### 5. –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! üéâ

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º |
| `/menu`  | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/admin` | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN_ID) |

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/start`
2. –í—ã–±–∏—Ä–∞–µ—Ç –≥–æ–¥ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ—é –≥—Ä—É–ø–ø—É
4. –ü–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º

### –ú–µ–Ω—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

- **–°–µ–≥–æ–¥–Ω—è** ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
- **–ó–∞–≤—Ç—Ä–∞** ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- **–ù–µ–¥–µ–ª—è** ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ 7 –¥–Ω–µ–π
- **–î–∞—Ç–∞** ‚Äî –≤–≤–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç: –î–î.–ú–ú.–ì–ì–ì–ì)
- **–°–µ—Å—Å–∏—è** ‚Äî –∑–∞—á—ë—Ç—ã –∏ —ç–∫–∑–∞–º–µ–Ω—ã –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 90 –¥–Ω–µ–π

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏:
- ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è
- ‚ùå –û—Ç–º–µ–Ω–µ –∑–∞–Ω—è—Ç–∏—è
- ‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏, –∞—É–¥–∏—Ç–æ—Ä–∏–∏, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∞

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|--------------|----------|
| `BOT_TOKEN` | ‚úÖ | ‚Äî | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `ADMIN_ID` | ‚úÖ | ‚Äî | Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |
| `DATABASE_PATH` | ‚ùå | `data/bot.db` | –ü—É—Ç—å –∫ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö |
| `CHECK_INTERVAL_MINUTES` | ‚ùå | `10` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (5-15) |
| `SPBU_API_URL` | ‚ùå | `https://timetable.spbu.ru/api/v1` | URL API —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è |
| `GSOM_ALIAS` | ‚ùå | `GSOM` | Alias —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –≤ API |

## üõ† –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å ID = `ADMIN_ID`.

–ö–æ–º–∞–Ω–¥–∞: `/admin`

–§—É–Ω–∫—Ü–∏–∏:
- üìä **–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ—à–∏–±–∫–∏
- üîÑ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ** ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∏—Ö –≥—Ä—É–ø–ø—ã
- `schedule_snapshots` ‚Äî —Å–Ω–∏–º–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `sent_notifications` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∞–Ω—Ç–∏–¥—É–±–ª–∏–∫–∞—Ç—ã)
- `system_state` ‚Äî —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

## üåê API

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –°–ü–±–ì–£: `https://timetable.spbu.ru/api/v1`

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://timetable.spbu.ru/help/ui/index

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout. –§–æ—Ä–º–∞—Ç:
```
2024-09-28 10:30:00 - module_name - INFO - Message
```

–î–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª –∏–∑–º–µ–Ω–∏—Ç–µ `main.py`:
```python
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    handlers=[
        logging.StreamHandler(sys.stdout),
        logging.FileHandler("bot.log"),  # –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    ]
)
```

## üê≥ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ `Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "main.py"]
```

–ó–∞–ø—É—Å–∫:

```bash
docker build -t gsom-schedule-bot .
docker run -d --env-file .env --name gsom-bot gsom-schedule-bot
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –¢–æ–ª—å–∫–æ –±–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç GSOM SPbU
- –¢–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —á–∞—Ç—ã (–Ω–µ –≥—Ä—É–ø–ø—ã)
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (UTC+3)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –•—Ä–∞–Ω–∏—Ç–µ `BOT_TOKEN` –≤ —Å–µ–∫—Ä–µ—Ç–µ
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –î–æ–±–∞–≤—å—Ç–µ `.env` –≤ `.gitignore`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üôã –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –°–ü–±–ì–£ –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `BOT_TOKEN` –∏ `ADMIN_ID`
